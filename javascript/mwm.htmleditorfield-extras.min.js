!function(t){t.entwine("ss",function(t){t("form.htmleditorfield-linkform").entwine({getEditorField:function(){return t("#"+this.getEditor().getInstance().editorId)},googleLinkTracking:function(){var t=this.getEditorField();return t.length&&t.hasClass("google-link-tracking")},emailFriendly:function(){var t=this.getEditorField();return t.length&&t.hasClass("email-friendly")},redraw:function(){this._super();var t=this.find(":input[name=LinkType]:checked").val(),e=this.emailFriendly();this.googleLinkTracking()&&this.find(".google-analytics-tracking").show().find(".field").show(),e||"internal"!==t&&"external"!==t||!this.find('.field[id$="TargetModal"]').length||this.find('.field[id$="TargetModal"]').show()},getLinkAttributes:function(){var e=this._super(),n=this.find(":input[name=utm_source]");if(this.find(":input[name=TargetModal]").is(":checked")&&(e["data-toggle"]="modal"),e.hasOwnProperty("href")&&0!=e.href.indexOf("mailto:")&&n.length&&n.val()){var i=this.find(":input[name=utm_medium]").val(),a=this.find(":input[name=utm_term]").val(),r=this.find(":input[name=utm_content]").val(),l=this.find(":input[name=utm_campaign]").val(),o={utm_source:encodeURIComponent(n.val())};o.utm_medium=i?i:encodeURIComponent("none"),a&&(o.utm_term=encodeURIComponent(a)),r&&(o.utm_content=encodeURIComponent(r)),l&&(o.utm_campaign=encodeURIComponent(l)),e.href+=-1!=e.href.indexOf("?")?"&amp;"+t.param(o).replace("&","&amp;"):"?"+t.param(o)}return e},getCurrentLink:function(){var e=this._super(),n=this.googleLinkTracking();if(null!==e&&!n)return e;var i=this.getSelection(),a=null;if(i.length&&(a=i.is("a")?i:i=i.parents("a:first")),a&&a.length&&this.modifySelection(function(t){t.selectNode(a[0])}),a.attr("href")||(a=null),a&&a.hasData("toggle")&&"modal"==a.data("toggle")&&(e.TargetModal=!0),n)if(null!==e){var r=a.attr("href").replace("&amp;","&"),l=-1!=r.indexOf("?")?r.substring(r.indexOf("?")+1,r.length):"";if(l){var o,d=this.deparam(l);d&&!t.isEmptyObject(d)&&t.each(d,function(t,n){0==t.indexOf("utm_")&&(o=t+"="+n,e[t]=decodeURIComponent(n),r=r.replace(o,"").replace(/[\?|&]+$/,""))}),r.match(/^\[sitetree_link(?:\s*|%20|,)?id=([0-9]+)\]?(#.*)?$/i)?(e.LinkType="internal",e.internal=RegExp.$1,e.Anchor=RegExp.$2?RegExp.$2.substr(1):"",e.hasOwnProperty("external")&&delete e.external):e.external=r}}else{var u=this.getEditorField(),m=u.data("utmSource"),s=u.data("utmMedium"),g=u.data("utmTerm"),h=u.data("utmContent"),f=u.data("utmCampaign");m&&(e.utm_source=0==m.indexOf("#")&&t(m).length?t(m).is(":input")?t(m).val():t(m).text():m),s&&(e.utm_medium=0==s.indexOf("#")&&t(s).length?t(s).is(":input")?t(s).val():t(s).text():s),g&&(e.utm_term=0==g.indexOf("#")&&t(g).length?t(g).is(":input")?t(g).val():t(g).text():g),h&&(e.utm_content=0==h.indexOf("#")&&t(h).length?t(h).is(":input")?t(h).val():t(h).text():h),f&&(e.utm_campaign=0==f.indexOf("#")&&t(f).length?t(f).is(":input")?t(f).val():t(f).text():f)}return e},deparam:function(t){t=t.substring(t.indexOf("?")+1).split("&");var e,n,i={},a=decodeURIComponent;for(n=t.length;n>0;)e=t[--n].split("="),i[a(e[0])]=a(e[1]);return i}})})}(jQuery);